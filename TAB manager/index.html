<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Tab Organizer Pro - Animated Edition</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#1e293b">

<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<style>
    body {
        font-family: 'Inter', sans-serif;
        background: radial-gradient(circle at top left, #1e293b, #0f172a);
        min-height: 100vh;
        color: #cbd5e1;
    }
    .glass {
        background: rgba(30, 41, 59, 0.7);
        backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.08);
    }
    
    .glass-card {
        background: rgba(255, 255, 255, 0.03);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        border: 1px solid transparent;
    }
    
    .glass-card:hover {
        transform: translateY(-4px) scale(1.01);
        background: rgba(255, 255, 255, 0.06);
        border-color: rgba(255, 255, 255, 0.1);
        box-shadow: 0 10px 20px -10px rgba(0,0,0,0.5);
    }

    @keyframes modalIn {
        from { opacity: 0; transform: scale(0.9) translateY(20px); }
        to { opacity: 1; transform: scale(1) translateY(0); }
    }

    .modal-content {
        animation: modalIn 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    .smart-highlight {
        background: rgba(59, 130, 246, 0.12) !important;
        border-color: rgba(59, 130, 246, 0.5) !important;
        box-shadow: 0 0 15px rgba(59, 130, 246, 0.2);
    }

    .watching-now {
        background: rgba(34, 197, 94, 0.15) !important;
        border-color: rgba(34, 197, 94, 0.6) !important;
        box-shadow: 0 0 25px rgba(34, 197, 94, 0.25);
    }

    .modal-active { display: flex !important; }

    .switch { position: relative; display: inline-block; width: 34px; height: 20px; }
    .switch input { opacity: 0; width: 0; height: 0; }
    .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #334155; transition: .4s; border-radius: 34px; }
    .slider:before { position: absolute; content: ""; height: 14px; width: 14px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
    input:checked + .slider { background-color: #22c55e; }
    input:checked + .slider:before { transform: translateX(14px); }

    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-thumb { background: rgba(255, 255, 255, 0.1); border-radius: 10px; }
</style>
</head>
<body class="p-4 md:p-10">
<div class="max-w-5xl mx-auto">
<header class="flex flex-col md:flex-row justify-between items-center gap-6 mb-12">
<div>
<h1 class="text-3xl font-bold text-white tracking-tight flex items-center gap-3">
<span class="bg-blue-600/20 p-2 rounded-xl border border-blue-500/20">üìë</span> Tab Organizer
</h1>
<p class="text-slate-500 text-sm mt-1">Organiza tu flujo de trabajo con elegancia.</p>
</div>
<div class="flex gap-3">
<button id="manageBtn" onclick="toggleManageCategories()" class="px-4 py-2 rounded-lg border border-slate-700 hover:bg-slate-800 transition text-sm font-medium">Gestionar</button>
<button onclick="openCategoryModal()" class="px-4 py-2 rounded-lg bg-blue-600 hover:bg-blue-500 text-white shadow-lg transition text-sm font-medium">+ Categor√≠a</button>
<button onclick="openProjectModal()" class="px-4 py-2 rounded-lg bg-slate-800 hover:bg-slate-700 transition text-sm font-medium">Backup</button>
</div>
</header>

<div id="sections-container" class="space-y-6"></div>
</div>

<div id="link-modal" class="hidden fixed inset-0 bg-slate-950/80 backdrop-blur-sm z-50 items-center justify-center p-4">
<div class="glass modal-content p-8 rounded-3xl w-full max-w-md shadow-2xl">
<h3 id="link-modal-title" class="text-xl font-bold text-white mb-6">Link</h3>
<div class="space-y-4">
<input id="link-url" disabled class="w-full bg-slate-900/50 border border-slate-800 p-3 rounded-xl text-slate-500 text-sm" />
<input id="link-title" placeholder="T√≠tulo del link" class="w-full bg-slate-800 border border-slate-700 p-3 rounded-xl text-white outline-none focus:border-blue-500 transition" />
<textarea id="link-desc" placeholder="Descripci√≥n corta (opcional)" rows="3" class="w-full bg-slate-800 border border-slate-700 p-3 rounded-xl text-white outline-none focus:border-blue-500 transition"></textarea>
<div class="flex gap-3 pt-2">
<button class="flex-1 bg-blue-600 py-3 rounded-xl font-bold text-white hover:bg-blue-500 transition" onclick="saveLink()">Guardar Link</button>
<button class="px-6 py-3 rounded-xl bg-slate-800 font-bold hover:bg-slate-700 transition" onclick="closeLinkModal()">Cancelar</button>
</div>
</div>
</div>
</div>

<div id="category-modal" class="hidden fixed inset-0 bg-slate-950/80 backdrop-blur-sm z-50 items-center justify-center p-4">
<div class="glass modal-content p-8 rounded-3xl w-full max-w-md shadow-2xl">
<h3 id="category-modal-title" class="text-xl font-bold text-white mb-6">Ajustes de Categor√≠a</h3>
<div class="space-y-4 mb-6">
<input id="cat-name" placeholder="Nombre" class="w-full bg-slate-800 border border-slate-700 p-3 rounded-xl text-white outline-none focus:border-blue-500 transition" />
<input id="cat-progress" placeholder="Estado (Video 5...)" class="w-full bg-slate-800 border border-slate-700 p-3 rounded-xl text-blue-400 text-sm outline-none" />
<textarea id="cat-desc" placeholder="Descripci√≥n General" rows="2" class="w-full bg-slate-800 border border-slate-700 p-3 rounded-xl text-slate-300 text-sm outline-none"></textarea>
</div>
<div class="flex flex-wrap gap-2 mb-6" id="icon-grid"></div>
<div class="flex flex-wrap gap-2 mb-8" id="color-grid"></div>
<div class="flex gap-3">
<button class="flex-1 bg-blue-600 py-3 rounded-xl font-bold text-white" onclick="saveCategory()">Guardar</button>
<button class="px-6 py-3 rounded-xl bg-slate-800 font-bold" onclick="closeCategoryModal()">Cancelar</button>
</div>
</div>
</div>

<div id="project-modal" class="hidden fixed inset-0 bg-slate-950/80 backdrop-blur-sm z-50 items-center justify-center p-4">
<div class="glass modal-content p-8 rounded-3xl w-full max-w-lg shadow-2xl text-center">
<h3 class="text-xl font-bold text-white mb-6">Backup de Datos</h3>
<div class="grid grid-cols-2 gap-4 mb-6">
<button class="p-4 rounded-2xl bg-slate-800 border border-slate-700 hover:bg-slate-700 transition" onclick="exportProject()">üì§ Exportar</button>
<button class="p-4 rounded-2xl bg-slate-800 border border-slate-700 hover:bg-slate-700 transition" onclick="triggerImportProject()">üì• Importar</button>
</div>
<button class="w-full p-3 rounded-xl bg-slate-900 text-slate-400 hover:text-white" onclick="closeProjectModal()">Cerrar</button>
<input id="import-project-file" type="file" accept=".json" hidden />
</div>
</div>

<script>
// ================= DATA =================
let SECTIONS = { work: { name:'WORK', icon:'üìÅ', color:'#4a9eff', task:'', progress:'', description:'', links:[] } };
let openSections = new Set();
let activeCategory = null, activeIndex = null, focusCategory = null, manageCategories = false, editingCategoryKey = null;
const ICONS = ['üìÅ','üìö','üé¨','üß†','‚≠ê','üéØ','üõ†Ô∏è','üßæ','üí°','üìå','üóÇÔ∏è','üß©','üß™','üîñ'];
const COLORS = ['#4a9eff','#a78bfa','#fbbf24','#4ade80','#ef4444','#22d3ee','#f472b6'];

function save(){ localStorage.setItem('tabOrganizer', JSON.stringify(SECTIONS)); }
function load(){
const s = localStorage.getItem('tabOrganizer');
if (s) { try { SECTIONS = JSON.parse(s); } catch(e) {} }
}

function escapeHtml(str){ return String(str ?? '').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }
function escapeAttr(str){ return escapeHtml(str).replace(/`/g,'&#96;'); }

// ================= UI RENDER =================
function render(){
const container = document.getElementById('sections-container');
container.innerHTML = '';

Object.keys(SECTIONS).forEach(k => {
    if (focusCategory && focusCategory !== k) return;
    const s = SECTIONS[k];
    const isOpen = openSections.has(k);
    const div = document.createElement('div');
    div.className = `glass rounded-3xl overflow-hidden border-l-[6px] shadow-lg mb-6 transition-all`;
    div.style.borderColor = s.color;

    div.innerHTML = `
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center p-6 cursor-pointer hover:bg-white/[0.02] transition" onclick="toggleSectionDisplay('${k}')">
            <div class="flex flex-col gap-1">
                <div class="flex items-center gap-4">
                    <span class="text-3xl">${s.icon}</span>
                    <h2 class="text-xl font-bold text-white uppercase">${escapeHtml(s.name)}</h2>
                    ${s.progress ? `<span class="text-[10px] bg-blue-500/20 px-2 py-0.5 rounded text-blue-400 font-bold border border-blue-500/30 uppercase">${escapeHtml(s.progress)}</span>` : ''}
                </div>
                ${s.description ? `<p class="text-xs text-slate-500 ml-12 mt-1 line-clamp-1">${escapeHtml(s.description)}</p>` : ''}
            </div>
            <div class="flex items-center gap-3 mt-4 md:mt-0" onclick="event.stopPropagation()">
                <button class="px-4 py-2 rounded-xl text-xs font-bold text-blue-400 bg-blue-400/10 hover:bg-blue-400/20 transition" onclick="addLink('${k}')">+ LINK</button>
                <button class="px-3 py-2 rounded-xl text-xs font-bold text-slate-400 hover:bg-slate-700 transition" onclick="toggleFocus('${k}')">${focusCategory===k?'EXIT':'FOCUS'}</button>
                ${manageCategories ? `<button class="px-3 py-2 rounded-xl text-xs font-bold bg-white/10 hover:bg-white/20 transition" onclick="openCategoryModal('${k}')">EDIT</button>` : ''}
            </div>
        </div>

        <div class="${isOpen ? '' : 'hidden'} p-6 pt-0 bg-black/10 border-t border-white/5 transition-all">
            <div class="mb-6 p-5 rounded-2xl bg-white/[0.03] border border-white/5 flex items-center gap-4 mt-6 group" onclick="event.stopPropagation()">
                <div class="w-1.5 h-10 rounded-full" style="background:${s.color}"></div>
                <div class="flex-1">
                    <p class="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Misi√≥n Actual</p>
                    <input class="w-full bg-transparent text-sm font-medium text-white outline-none focus:text-blue-400 transition"
                           value="${s.task || ''}" placeholder="Escribe para buscar links..."
                           onkeydown="if(event.key==='Enter') { saveTask('${k}', this.value); this.blur(); }"
                           onblur="saveTask('${k}', this.value)">
                </div>
                ${s.task ? `<button class="text-xs text-red-500 opacity-0 group-hover:opacity-100 transition" onclick="saveTask('${k}', '')">Limpiar</button>` : ''}
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                ${renderLinks(k)}
            </div>
        </div>
    `;
    container.appendChild(div);
});
document.getElementById('manageBtn').innerText = manageCategories ? 'Hecho' : 'Gestionar';
}

function renderLinks(k){
const links = SECTIONS[k].links || [];
const taskText = (SECTIONS[k].task || '').toLowerCase().trim();
const taskWords = taskText.split(/\s+/).filter(w => w.length > 2);

if (!links.length) return `<div class="col-span-full py-6 text-center text-slate-600 italic">No hay links guardados.</div>`;

return links.map((l, i) => {
    const titleMatch = taskWords.some(word => l.title.toLowerCase().includes(word));
    const descMatch = taskWords.some(word => (l.description || '').toLowerCase().includes(word));
    const isSmart = taskWords.length > 0 && (titleMatch || descMatch);
    const isWatching = l.isWatching || false;
    const embed = getEmbedInfo(l.url);
    const pid = `${k}-${i}`;

    let cardClass = "glass-card p-5 rounded-2xl border ";
    if (isWatching) cardClass += "watching-now";
    else if (isSmart) cardClass += "smart-highlight";

    return `
    <div class="${cardClass} group relative" onclick="event.stopPropagation()">
        <div class="flex justify-between items-start gap-4">
            <div class="flex-1 min-w-0">
                <a href="${escapeAttr(l.url)}" target="_blank" class="text-sm font-bold ${isWatching ? 'text-green-400' : 'text-blue-400'} hover:underline block truncate">
                    ${isWatching ? 'üü¢ ' : ''}${escapeHtml(l.title)}
                </a>
                <p class="text-[11px] text-slate-500 mt-1 line-clamp-1">${escapeHtml(l.description || 'Sin descripci√≥n.')}</p>
            </div>
            <div class="flex flex-col items-end gap-3 opacity-0 group-hover:opacity-100 transition-all duration-300" onclick="event.stopPropagation()">
                <label class="switch" title="Viendo ahora">
                    <input type="checkbox" ${isWatching ? 'checked' : ''} onchange="toggleWatching('${k}', ${i})">
                    <span class="slider"></span>
                </label>
                <div class="flex gap-2">
                    <button class="hover:scale-125 transition" onclick="editLink('${k}', ${i})">‚úèÔ∏è</button>
                    <button class="text-red-500/50 hover:text-red-500 transition" onclick="deleteLink('${k}', ${i})">üóëÔ∏è</button>
                </div>
            </div>
        </div>
        ${embed ? `<button class="w-full mt-4 py-1.5 rounded-lg bg-white/5 text-[10px] font-bold text-slate-400 uppercase hover:bg-white/10 transition" onclick="togglePreview('${pid}', '${embed.type}', '${escapeAttr(embed.src)}')">Preview</button><div id="preview-${pid}" class="mt-3"></div>` : ''}
    </div>`;
}).join('');
}

// ================= LOGICA =================
function toggleSectionDisplay(k) {
if (openSections.has(k)) openSections.delete(k);
else openSections.add(k);
render();
}
function saveTask(k, val) { SECTIONS[k].task = val; save(); render(); }
function toggleWatching(k, i) {
SECTIONS[k].links.forEach((link, idx) => { if(idx !== i) link.isWatching = false; });
SECTIONS[k].links[i].isWatching = !SECTIONS[k].links[i].isWatching;
save(); render();
}
function toggleFocus(k){ focusCategory = (focusCategory === k) ? null : k; render(); }
function toggleManageCategories(){ manageCategories = !manageCategories; render(); }
function openCategoryModal(key=null){
editingCategoryKey = key;
document.getElementById('cat-name').value = key ? SECTIONS[key].name : '';
document.getElementById('cat-progress').value = key ? SECTIONS[key].progress : '';
document.getElementById('cat-desc').value = key ? SECTIONS[key].description : '';
renderPickers(key ? SECTIONS[key].icon : 'üìÅ', key ? SECTIONS[key].color : '#4a9eff');
document.getElementById('category-modal').classList.add('modal-active');
}
function renderPickers(selI, selC){
const ig = document.getElementById('icon-grid'); ig.innerHTML = '';
ICONS.forEach(i => {
const d = document.createElement('div');
d.className = `cursor-pointer p-2 rounded-xl text-xl bg-white/5 transition hover:bg-white/10 ${i===selI ? 'ring-2 ring-blue-500' : ''}`;
d.textContent = i; d.onclick = () => renderPickers(i, selC);
ig.appendChild(d); if(i===selI) d.id = "selected-icon";
});
const cg = document.getElementById('color-grid'); cg.innerHTML = '';
COLORS.forEach(c => {
const d = document.createElement('div');
d.className = `w-8 h-8 rounded-full cursor-pointer border-2 transition hover:scale-110 ${c===selC ? 'border-white' : 'border-transparent'}`;
d.style.background = c; d.onclick = () => renderPickers(selI, c);
cg.appendChild(d); if(c===selC) d.id = "selected-color";
});
}
function saveCategory(){
const name = document.getElementById('cat-name').value.trim();
if (!name) return;
const data = {
name,
icon: document.getElementById('selected-icon').textContent,
color: document.getElementById('selected-color').style.backgroundColor,
progress: document.getElementById('cat-progress').value,
description: document.getElementById('cat-desc').value
};
if (editingCategoryKey) Object.assign(SECTIONS[editingCategoryKey], data);
else SECTIONS[Date.now()] = { ...data, task:'', links:[] };
save(); closeCategoryModal(); render();
}
function closeCategoryModal(){ document.getElementById('category-modal').classList.remove('modal-active'); }
function addLink(k){
const url = prompt('Pega la URL:'); if (!url) return;
activeCategory = k; activeIndex = null;
document.getElementById('link-url').value = url;
document.getElementById('link-title').value = '';
document.getElementById('link-desc').value = '';
document.getElementById('link-modal').classList.add('modal-active');
}
function editLink(k, i){
activeCategory = k; activeIndex = i;
const l = SECTIONS[k].links[i];
document.getElementById('link-url').value = l.url;
document.getElementById('link-title').value = l.title;
document.getElementById('link-desc').value = l.description || '';
document.getElementById('link-modal').classList.add('modal-active');
}
function saveLink(){
const l = {
url: document.getElementById('link-url').value,
title: document.getElementById('link-title').value || 'Link',
description: document.getElementById('link-desc').value,
isWatching: activeIndex !== null ? SECTIONS[activeCategory].links[activeIndex].isWatching : false
};
if (activeIndex === null) SECTIONS[activeCategory].links.push(l);
else SECTIONS[activeCategory].links[activeIndex] = l;
save(); closeLinkModal(); render();
}
function closeLinkModal(){ document.getElementById('link-modal').classList.remove('modal-active'); }
function deleteLink(k, i){ if(confirm('¬øBorrar?')) { SECTIONS[k].links.splice(i, 1); save(); render(); } }
function getYouTubeVideoId(url){
try{
const u = new URL(url);
if (u.hostname.includes('youtu.be')) return u.pathname.replace('/','');
if (u.hostname.includes('youtube.com')) return u.searchParams.get('v');
} catch(e){} return null;
}
function getEmbedInfo(url){
const ytId = getYouTubeVideoId(url);
if (ytId) return { type:'youtube', src:`https://www.youtube-nocookie.com/embed/${ytId}` };
if (url.match(/\.(mp4|webm)$/i)) return { type:'file', src:url };
return null;
}
function togglePreview(id, type, src){
const el = document.getElementById(`preview-${id}`);
if (el.innerHTML) { el.innerHTML = ''; return; }
el.innerHTML = `<div class="aspect-video bg-black rounded-xl overflow-hidden border border-white/10">         ${type === 'file' ? `<video controls class="w-full h-full" src="${src}"></video>` : `<iframe class="w-full h-full" src="${src}" allowfullscreen></iframe>`}     </div>`;
}
function openProjectModal(){ document.getElementById('project-modal').classList.add('modal-active'); }
function closeProjectModal(){ document.getElementById('project-modal').classList.remove('modal-active'); }
function exportProject(){
const blob = new Blob([JSON.stringify(SECTIONS)], {type:'application/json'});
const a = document.createElement('a'); a.href = URL.createObjectURL(blob);
a.download = 'backup.json'; a.click();
}
function triggerImportProject(){ document.getElementById('import-project-file').click(); }
document.getElementById('import-project-file').onchange = async (e) => {
const text = await e.target.files[0].text();
SECTIONS = JSON.parse(text); save(); render(); closeProjectModal();
};

// REGISTRO DE SERVICE WORKER PARA QUE WINDOWS LA VEA COMO APP
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('data:text/javascript;base64,c2VsZi5hZGRFdmVudExpc3RlbmVyKCdmZXRjaCcsIGV2ID0+IGV2KTs=');
}

load();
render();
</script>
</body>
</html>
